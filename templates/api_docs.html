{% extends "base.html" %}

{% block title %}API Documentation - Flask MCP Server{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">API Documentation</h1>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm" onclick="exportOpenAPI()">
                    <i data-feather="download" class="me-1"></i>Export OpenAPI
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Overview -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    <i data-feather="info" class="me-2"></i>
                    MCP Server API Overview
                </h5>
                <p class="card-text">
                    This Flask-based MCP server implements the Model Context Protocol for seamless integration with Claude AI. 
                    The server provides both MCP protocol endpoints and RESTful API endpoints for management.
                </p>
                <div class="row">
                    <div class="col-md-6">
                        <h6>Base URL</h6>
                        <code id="baseUrl">{{ request.url_root }}</code>
                    </div>
                    <div class="col-md-6">
                        <h6>Protocol Version</h6>
                        <code>MCP 2024-11-05</code>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MCP Protocol Endpoints -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="zap" class="me-2"></i>
                    MCP Protocol Endpoints
                </h5>
            </div>
            <div class="card-body">
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <code class="endpoint-path">/mcp/mcp</code>
                        <span class="endpoint-title">MCP Protocol Handler</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Main endpoint for MCP protocol communication. Handles all MCP methods including tool calls and resource access.</p>
                        
                        <h6>Supported Methods:</h6>
                        <ul class="method-list">
                            <li><code>initialize</code> - Initialize MCP connection</li>
                            <li><code>tools/list</code> - List available tools</li>
                            <li><code>tools/call</code> - Execute a tool</li>
                            <li><code>resources/list</code> - List available resources</li>
                            <li><code>resources/read</code> - Read resource content</li>
                        </ul>
                        
                        <div class="code-example">
                            <h6>Example Request:</h6>
                            <pre><code class="language-json">{
  "method": "tools/list",
  "params": {}
}</code></pre>
                            
                            <h6>Example Response:</h6>
                            <pre><code class="language-json">{
  "tools": [
    {
      "name": "echo",
      "description": "Echo back the input message",
      "inputSchema": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Message to echo back"
          }
        },
        "required": ["message"]
      }
    }
  ]
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Management API Endpoints -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="settings" class="me-2"></i>
                    Management API Endpoints
                </h5>
            </div>
            <div class="card-body">
                <!-- Tools API -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <code class="endpoint-path">/mcp/tools</code>
                        <span class="endpoint-title">List Tools</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Retrieve all registered tools.</p>
                        <div class="code-example">
                            <h6>Response:</h6>
                            <pre><code class="language-json">[
  {
    "id": 1,
    "name": "echo",
    "description": "Echo tool",
    "schema": {...},
    "endpoint": null,
    "method": "POST",
    "is_active": true,
    "created_at": "2024-01-01T00:00:00",
    "updated_at": "2024-01-01T00:00:00"
  }
]</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <code class="endpoint-path">/mcp/tools</code>
                        <span class="endpoint-title">Create Tool</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Register a new tool with the MCP server.</p>
                        <div class="code-example">
                            <h6>Request Body:</h6>
                            <pre><code class="language-json">{
  "name": "my_tool",
  "description": "My custom tool",
  "schema": {
    "type": "object",
    "properties": {
      "input": {
        "type": "string",
        "description": "Tool input"
      }
    },
    "required": ["input"]
  },
  "endpoint": "https://api.example.com/tool",
  "method": "POST"
}</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-put">PUT</span>
                        <code class="endpoint-path">/api/tools/{id}</code>
                        <span class="endpoint-title">Update Tool</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Update an existing tool configuration.</p>
                    </div>
                </div>
                
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-delete">DELETE</span>
                        <code class="endpoint-path">/api/tools/{id}</code>
                        <span class="endpoint-title">Delete Tool</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Deactivate a tool (soft delete).</p>
                    </div>
                </div>
                
                <!-- Resources API -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <code class="endpoint-path">/api/resources</code>
                        <span class="endpoint-title">List Resources</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Retrieve all available resources.</p>
                    </div>
                </div>
                
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-post">POST</span>
                        <code class="endpoint-path">/api/resources</code>
                        <span class="endpoint-title">Create Resource</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Register a new resource.</p>
                        <div class="code-example">
                            <h6>Request Body:</h6>
                            <pre><code class="language-json">{
  "name": "my_resource",
  "description": "My custom resource",
  "uri": "file:///path/to/resource",
  "mime_type": "text/plain"
}</code></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Stats API -->
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <code class="endpoint-path">/api/stats</code>
                        <span class="endpoint-title">Server Statistics</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Get server performance and usage statistics.</p>
                        <div class="code-example">
                            <h6>Response:</h6>
                            <pre><code class="language-json">{
  "total_tools": 5,
  "total_resources": 3,
  "total_requests": 142,
  "error_rate": 2.1,
  "avg_duration_ms": 45.2,
  "uptime": "2h 15m"
}</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method-badge method-get">GET</span>
                        <code class="endpoint-path">/api/health</code>
                        <span class="endpoint-title">Health Check</span>
                    </div>
                    <div class="endpoint-body">
                        <p>Check server health status.</p>
                        <div class="code-example">
                            <h6>Response:</h6>
                            <pre><code class="language-json">{
  "status": "healthy",
  "timestamp": "2024-01-01T00:00:00Z",
  "version": "1.0.0"
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Error Codes -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="alert-triangle" class="me-2"></i>
                    Error Codes
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Message</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>-32700</code></td>
                                <td>Parse error</td>
                                <td>Invalid JSON was received</td>
                            </tr>
                            <tr>
                                <td><code>-32600</code></td>
                                <td>Invalid Request</td>
                                <td>The JSON sent is not a valid Request object</td>
                            </tr>
                            <tr>
                                <td><code>-32601</code></td>
                                <td>Method not found</td>
                                <td>The method does not exist / is not available</td>
                            </tr>
                            <tr>
                                <td><code>-32602</code></td>
                                <td>Invalid params</td>
                                <td>Invalid method parameter(s)</td>
                            </tr>
                            <tr>
                                <td><code>-32603</code></td>
                                <td>Internal error</td>
                                <td>Internal server error</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function exportOpenAPI() {
    // This would generate and download an OpenAPI spec
    alert('OpenAPI export functionality would be implemented here');
}

// Initialize syntax highlighting
document.addEventListener('DOMContentLoaded', function() {
    Prism.highlightAll();
    feather.replace();
});
</script>
{% endblock %}
